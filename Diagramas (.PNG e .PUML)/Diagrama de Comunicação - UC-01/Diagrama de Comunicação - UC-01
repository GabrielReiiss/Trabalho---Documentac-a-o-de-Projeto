@startuml
title Diagrama de Comunicação - Curtir Postagem (LikeUseCase)

actor Usuário
participant "Frontend (Next.js)" as FE
participant "API Gateway (Go)" as GW
participant "Backend Principal (Go)" as BE
database "Banco de Dados (PostgreSQL)" as DB
queue "Fila (RabbitMQ)" as MQ
participant "Serviço de Notificações (Go)" as NS

Usuário -> FE : 1: clicaEmCurtir(postId)
FE -> GW : 2: POST /graphql (mutation: likePost)
GW -> BE : 3: executa LikeUseCase(postId, userId)
BE -> DB : 4: Verifica/Insere/Deleta em "like"
DB -> BE : 5: (Sucesso na transacao)
BE -> GW : 6: (Sucesso, 200)
GW -> FE : 7: (Sucesso, 200)
FE -> Usuário : 8: (Atualiza UI - Curtida aplicada)

BE -> MQ : 9: publicaEvento("user_like_event", {postId, userId})
MQ -> NS : 10: consomeEvento("user_like_event")
NS -> DB : 11: Busca dono do post (SELECT user_id FROM posts...)
DB -> NS : 12: (Retorna postOwnerId)
NS -> DB : 13: Insere em "notifications" (userId=postOwnerId, ...)
DB -> NS : 14: (Sucesso)

@enduml